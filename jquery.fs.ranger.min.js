/*
 * Ranger Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.1
 *
 * Copyright Â© 2012 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(g){function l(a){for(var a=a||{},a=g.extend({},m,a),c=g(this),b=0,f=c.length;b<f;b++){var e=c.eq(b),h=a;if(!e.data("ranger")){var i=parseFloat(e.attr("min"))||0,n=parseFloat(e.attr("max"))||100,p=parseFloat(e.attr("step"))||1;e.val();var d='<div class="ranger';h.vertical&&(d+=" ranger-vertical");h.labels&&(d+=" ranger-labels");d+='">';d+='<div class="ranger-track">';d+='<span class="ranger-handle"></span>';d+="</div>";d+="</div>";e.addClass("ranger-element").after(d);var d=e.next(".ranger"), j=d.find(".ranger-track"),k=d.find(".ranger-handle"),l=d.find(".ranger-output");h.labels&&(h.vertical?d.prepend('<span class="ranger-label max">'+n+"</span>").append('<span class="ranger-label min">'+i+"</span>"):d.prepend('<span class="ranger-label min">'+i+"</span>").append('<span class="ranger-label max">'+n+"</span>"));d.is(":disabled")&&d.addClass("disabled");h=g.extend({$input:e,$ranger:d,$track:j,$handle:k,$output:l,min:i,max:n,step:p,stepDigits:p.toString().length-p.toString().indexOf(".")}, h);e.on("focus.ranger",h,r).on("blur.ranger",h,s);d.on("mousedown.ranger",".ranger-track",h,t).on("mousedown.ranger",".ranger-handle",h,u).data("ranger",h);q.reset.apply(e,[h])}}return c}function t(a){a.preventDefault();a.stopPropagation();i(a);g("body").on("mousemove.ranger",a.data,i).one("mouseup.ranger",a.data,j)}function u(a){a.preventDefault();a.stopPropagation();g("body").on("mousemove.ranger",a.data,i).one("mouseup.ranger",a.data,j)}function i(a){var c=a.data,b=c.$track.offset();k.apply(c.$input, [c,!0==c.vertical?c.percentLimit-(a.pageY-b.top)/c.trackLimit:(a.pageX-b.left)/c.trackLimit])}function j(){g("body").off("mousemove.ranger")}function r(a){a.data.$ranger.addClass("focus")}function s(a){a.data.$ranger.removeClass("focus")}function k(a,c){1<a.increment&&(c=Math.round(c*a.stepCount)*a.increment/a.trackLimit);0>c&&(c=0);1<c&&(c=1);var b=(a.min-a.max)*c,b=-parseFloat(b.toFixed(a.stepDigits)),c=c*a.percentLimit;!0==a.vertical?a.$handle.css({bottom:100*c+"%"}):a.$handle.css({left:100*c+ "%"});b+=a.min;console.log(b)}var m={customClass:"",labels:!0,vertical:!1},q={defaults:function(a){m=g.extend(m,a||{});return g(this)},disable:function(){for(var a=g(this),c=0,b=a.length;c<b;c++){var f=a.eq(c),e=f.next(".ranger");f.attr("disabled","disabled");e.addClass("disabled")}return a},reset:function(a){for(var c=g(this),b,f=0,e=c.length;f<e;f++)if(b=a||c.eq(f).data("ranger"),"undefined"!=typeof b){!0==b.vertical?(b.trackHeight=b.$track.outerHeight(),b.handleHeight=b.$handle.outerHeight(),b.trackLimit= b.trackHeight-b.handleHeight,b.percentLimit=b.trackLimit/b.trackHeight):(b.trackWidth=b.$track.outerWidth(),b.handleWidth=b.$handle.outerWidth(),b.trackLimit=b.trackWidth-b.handleWidth,b.percentLimit=b.trackLimit/b.trackWidth);b.stepCount=(b.max-b.min)/b.step;b.increment=b.trackLimit/b.stepCount;var h=b.$input.val()/(b.max-b.min);k.apply(b.$input,[b,h])}return c},enable:function(){for(var a=g(this),c=0,b=a.length;c<b;c++){var f=a.eq(c),e=f.next(".ranger");f.attr("disabled",null);e.removeClass("disabled")}return a}, destroy:function(){for(var a=g(this),c=0,b=a.length;c<b;c++){var f=a.eq(c);g("label[for="+f.attr("id")+"]");var e=f.next(".ranger");e.find(".ranger-handle");e.off(".ranger").remove();f.off(".ranger").removeClass("ranger-element")}return a}};g.fn.ranger=function(a){return q[a]?q[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?l.apply(this,arguments):this}})(jQuery);