/*
 * Ranger Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.1.4
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function k(a){a=c.extend({},l,a);for(var b=c(this),m=0,g=b.length;m<g;m++){var f=b.eq(m),e=a;if(!f.data("ranger")){c.extend(e,f.data("ranger-options"));var n=parseFloat(f.attr("min"))||0,p=parseFloat(f.attr("max"))||100,q=parseFloat(f.attr("step"))||1;f.val();var d='<div class="ranger';e.vertical&&(d+=" ranger-vertical");e.labels&&(d+=" ranger-labels");d+='">';d+='<div class="ranger-track">';d+='<span class="ranger-handle">';d+='<span class="ranger-disc"></span>';d+="</span>";d+="</div>"; d+="</div>";f.addClass("ranger-element").after(d);var d=f.next(".ranger"),h=d.find(".ranger-track"),j=d.find(".ranger-handle"),k=d.find(".ranger-output");e.labels&&(e.vertical?d.prepend('<span class="ranger-label max">'+(e.labelMax?e.labelMax:p)+"</span>").append('<span class="ranger-label min">'+(e.labelMin?e.labelMin:n)+"</span>"):d.prepend('<span class="ranger-label min">'+(e.labelMin?e.labelMin:n)+"</span>").append('<span class="ranger-label max">'+(e.labelMax?e.labelMax:p)+"</span>"));d.is(":disabled")&& d.addClass("disabled");e=c.extend({$input:f,$ranger:d,$track:h,$handle:j,$output:k,min:n,max:p,step:q,stepDigits:q.toString().length-q.toString().indexOf(".")},e);f.on("focus.ranger",e,s).on("blur.ranger",e,t);d.on("mousedown.ranger",".ranger-track",e,u).on("mousedown.ranger",".ranger-handle",e,v).data("ranger",e);r.reset.apply(f,[e])}}return b}function u(a){a.preventDefault();a.stopPropagation();g(a);a.data.$ranger.addClass("focus");c("body").on("mousemove.ranger",a.data,g).one("mouseup.ranger", a.data,h)}function v(a){a.preventDefault();a.stopPropagation();a.data.$ranger.addClass("focus");c("body").on("mousemove.ranger",a.data,g).one("mouseup.ranger",a.data,h)}function g(a){var b=a.data,c=b.$track.offset();j.apply(b.$input,[b,!0==b.vertical?(a.pageY-c.top)/b.trackHeight:(a.pageX-c.left)/b.trackWidth])}function h(a){a.data.$ranger.removeClass("focus");c("body").off("mousemove.ranger")}function s(a){a.data.$ranger.addClass("focus")}function t(a){a.data.$ranger.removeClass("focus")}function j(a, b){1<a.increment&&(b=!0==a.vertical?Math.round(b*a.stepCount)*a.increment/a.trackHeight:Math.round(b*a.stepCount)*a.increment/a.trackWidth);0>b&&(b=0);1<b&&(b=1);var c=(a.min-a.max)*b,c=-parseFloat(c.toFixed(a.stepDigits));!0==a.vertical?(a.$handle.css({bottom:100*(1-b)+"%"}),c=a.min+(a.max-c)):(a.$handle.css({left:100*b+"%"}),c+=a.min);a.$input.val(c)}var l={customClass:"",labels:!0,labelMin:!1,labelMax:!1,vertical:!1},r={defaults:function(a){l=c.extend(l,a||{});return c(this)},disable:function(){return c(this).each(function(){var a= c(this),b=a.next(".ranger");a.attr("disabled","disabled");b.addClass("disabled")})},reset:function(a){return c(this).each(function(){var b=c(this),b=a||b.data("ranger");if("undefined"!=typeof b){b.stepCount=(b.max-b.min)/b.step;!0==b.vertical?(b.trackHeight=b.$track.outerHeight(),b.handleHeight=b.$handle.outerHeight(),b.increment=b.trackHeight/b.stepCount):(b.trackWidth=b.$track.outerWidth(),b.handleWidth=b.$handle.outerWidth(),b.increment=b.trackWidth/b.stepCount);var g=b.$input.val()/(b.max-b.min); j.apply(b.$input,[b,g])}})},enable:function(){return c(this).each(function(){var a=c(this),b=a.next(".ranger");a.attr("disabled",null);b.removeClass("disabled")})},destroy:function(){return c(this).each(function(){var a=c(this);c("label[for="+a.attr("id")+"]");var b=a.next(".ranger");b.find(".ranger-handle");b.off(".ranger").remove();a.off(".ranger").removeClass("ranger-element")})}};c.fn.ranger=function(a){return r[a]?r[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a|| !a?k.apply(this,arguments):this}})(jQuery);