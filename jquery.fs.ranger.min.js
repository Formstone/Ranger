/*
 * Ranger Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.1.3
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(c){function k(a){a=a||{};var b=c.extend({},f,a);return c(this).each(function(){var a=c(this);if(!a.data("ranger")){var e=parseFloat(a.attr("min"))||0,f=parseFloat(a.attr("max"))||100,g=parseFloat(a.attr("step"))||1;a.val();var d='<div class="ranger';b.vertical&&(d+=" ranger-vertical");b.labels&&(d+=" ranger-labels");d+='"><div class="ranger-track">';d+='<span class="ranger-handle">';d+='<span class="ranger-disc"></span>';d+="</span>";d+="</div>";d+="</div>";a.addClass("ranger-element").after(d); var d=a.next(".ranger"),h=d.find(".ranger-track"),j=d.find(".ranger-handle"),k=d.find(".ranger-output");b.labels&&(b.vertical?d.prepend('<span class="ranger-label max">'+(b.labelMax?b.labelMax:f)+"</span>").append('<span class="ranger-label min">'+(b.labelMin?b.labelMin:e)+"</span>"):d.prepend('<span class="ranger-label min">'+(b.labelMin?b.labelMin:e)+"</span>").append('<span class="ranger-label max">'+(b.labelMax?b.labelMax:f)+"</span>"));d.is(":disabled")&&d.addClass("disabled");e=c.extend({$input:a, $ranger:d,$track:h,$handle:j,$output:k,min:e,max:f,step:g,stepDigits:g.toString().length-g.toString().indexOf(".")},b);a.on("focus.ranger",e,m).on("blur.ranger",e,n);d.on("mousedown.ranger",".ranger-track",e,p).on("mousedown.ranger",".ranger-handle",e,q).data("ranger",e);l.reset.apply(a,[e])}})}function p(a){a.preventDefault();a.stopPropagation();g(a);a.data.$ranger.addClass("focus");c("body").on("mousemove.ranger",a.data,g).one("mouseup.ranger",a.data,h)}function q(a){a.preventDefault();a.stopPropagation(); a.data.$ranger.addClass("focus");c("body").on("mousemove.ranger",a.data,g).one("mouseup.ranger",a.data,h)}function g(a){var b=a.data,c=b.$track.offset();j.apply(b.$input,[b,!0==b.vertical?(a.pageY-c.top)/b.trackHeight:(a.pageX-c.left)/b.trackWidth])}function h(a){a.data.$ranger.removeClass("focus");c("body").off("mousemove.ranger")}function m(a){a.data.$ranger.addClass("focus")}function n(a){a.data.$ranger.removeClass("focus")}function j(a,b){1<a.increment&&(b=!0==a.vertical?Math.round(b*a.stepCount)* a.increment/a.trackHeight:Math.round(b*a.stepCount)*a.increment/a.trackWidth);0>b&&(b=0);1<b&&(b=1);var c=(a.min-a.max)*b,c=-parseFloat(c.toFixed(a.stepDigits));!0==a.vertical?(a.$handle.css({bottom:100*(1-b)+"%"}),c=a.min+(a.max-c)):(a.$handle.css({left:100*b+"%"}),c+=a.min);a.$input.val(c)}var f={customClass:"",labels:!0,labelMin:!1,labelMax:!1,vertical:!1},l={defaults:function(a){f=c.extend(f,a||{});return c(this)},disable:function(){return c(this).each(function(){var a=c(this),b=a.next(".ranger"); a.attr("disabled","disabled");b.addClass("disabled")})},reset:function(a){return c(this).each(function(){var b=c(this),b=a||b.data("ranger");if("undefined"!=typeof b){b.stepCount=(b.max-b.min)/b.step;!0==b.vertical?(b.trackHeight=b.$track.outerHeight(),b.handleHeight=b.$handle.outerHeight(),b.increment=b.trackHeight/b.stepCount):(b.trackWidth=b.$track.outerWidth(),b.handleWidth=b.$handle.outerWidth(),b.increment=b.trackWidth/b.stepCount);var f=b.$input.val()/(b.max-b.min);j.apply(b.$input,[b,f])}})}, enable:function(){return c(this).each(function(){var a=c(this),b=a.next(".ranger");a.attr("disabled",null);b.removeClass("disabled")})},destroy:function(){return c(this).each(function(){var a=c(this);c("label[for="+a.attr("id")+"]");var b=a.next(".ranger");b.find(".ranger-handle");b.off(".ranger").remove();a.off(".ranger").removeClass("ranger-element")})}};c.fn.ranger=function(a){return l[a]?l[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"===typeof a||!a?k.apply(this,arguments):this}})(jQuery);