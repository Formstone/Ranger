/*
 * Ranger Plugin [Formstone Library]
 * @author Ben Plum
 * @version 0.1.5
 *
 * Copyright Â© 2013 Ben Plum <mr@benplum.com>
 * Released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
 
if(jQuery)(function(e){function m(a){a=e.extend({},f,a);for(var b=e(this),d=0,g=b.length;d<g;d++)p(b.eq(d),a);return b}function p(a,b){if(!a.data("ranger")){e.extend(b,a.data("ranger-options"));b.formatter||(b.formatter=q);var d=parseFloat(a.attr("min"))||0,g=parseFloat(a.attr("max"))||100,f=parseFloat(a.attr("step"))||1,h=a.val()||d+(g-d)/2,c='<div class="ranger';b.vertical&&(c+=" ranger-vertical");b.labels&&(c+=" ranger-labels");c+='"><div class="ranger-track">';c+='<span class="ranger-handle">';c+='<span class="ranger-disc"></span>'; c+="</span>";c+="</div>";c+="</div>";a.addClass("ranger-element").after(c);var c=a.next(".ranger"),k=c.find(".ranger-track"),l=c.find(".ranger-handle"),m=c.find(".ranger-output");b.labels&&(b.vertical?c.prepend('<span class="ranger-label max">'+b.formatter.call(this,b.labelMax?b.labelMax:g)+"</span>").append('<span class="ranger-label min">'+b.formatter.call(this,b.labelMin?b.labelMin:d)+"</span>"):c.prepend('<span class="ranger-label min">'+b.formatter.call(this,b.labelMin?b.labelMin:d)+"</span>").append('<span class="ranger-label max">'+ b.formatter.call(this,b.labelMax?b.labelMax:g)+"</span>"));c.is(":disabled")&&c.addClass("disabled");b=e.extend({$input:a,$ranger:c,$track:k,$handle:l,$output:m,min:d,max:g,step:f,stepDigits:f.toString().length-f.toString().indexOf("."),value:h},b);a.on("focus.ranger",b,r).on("blur.ranger",b,s).on("change.ranger input.ranger",b,t);c.on("mousedown.ranger",".ranger-track",b,u).on("mousedown.ranger",".ranger-handle",b,v).data("ranger",b);n.reset.apply(a,[b])}}function u(a){a.preventDefault();a.stopPropagation(); h(a);a.data.$ranger.addClass("focus");e("body").on("mousemove.ranger",a.data,h).one("mouseup.ranger",a.data,k)}function v(a){a.preventDefault();a.stopPropagation();a.data.$ranger.addClass("focus");e("body").on("mousemove.ranger",a.data,h).one("mouseup.ranger",a.data,k)}function h(a){var b=a.data,d=b.$track.offset();l.apply(b.$input,[b,!0==b.vertical?(a.pageY-d.top)/b.trackHeight:(a.pageX-d.left)/b.trackWidth])}function k(a){a.data.$ranger.removeClass("focus");e("body").off("mousemove.ranger")}function r(a){a.data.$ranger.addClass("focus")} function s(a){a.data.$ranger.removeClass("focus")}function l(a,b){1<a.increment&&(b=!0==a.vertical?Math.round(b*a.stepCount)*a.increment/a.trackHeight:Math.round(b*a.stepCount)*a.increment/a.trackWidth);0>b&&(b=0);1<b&&(b=1);var d=(a.min-a.max)*b,d=-parseFloat(d.toFixed(a.stepDigits));!0==a.vertical?(a.$handle.css({bottom:100*(1-b)+"%"}),d=a.min+(a.max-d)):(a.$handle.css({left:100*b+"%"}),d+=a.min);d!=a.value&&(a.$input.val(d).trigger("change",[!0]),a.callback.call(a.$ranger,d),a.value=d)}function t(a, b){}function q(a){a=a.toString().split(".");a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return a.join(".")}var f={callback:e.noop,customClass:"",formatter:null,labels:!0,labelMin:!1,labelMax:!1,vertical:!1},n={defaults:function(a){f=e.extend(f,a||{});return e(this)},disable:function(){return e(this).each(function(a){a=e(this);var b=a.next(".ranger");a.attr("disabled","disabled");b.addClass("disabled")})},reset:function(a){return e(this).each(function(b){b=e(this);b=a||b.data("ranger");if("undefined"!= typeof b){b.stepCount=(b.max-b.min)/b.step;!0==b.vertical?(b.trackHeight=b.$track.outerHeight(),b.handleHeight=b.$handle.outerHeight(),b.increment=b.trackHeight/b.stepCount):(b.trackWidth=b.$track.outerWidth(),b.handleWidth=b.$handle.outerWidth(),b.increment=b.trackWidth/b.stepCount);var d=b.$input.val()/(b.max-b.min);l.apply(b.$input,[b,d])}})},enable:function(){return e(this).each(function(a){a=e(this);var b=a.next(".ranger");a.attr("disabled",null);b.removeClass("disabled")})},destroy:function(){return e(this).each(function(a){a= e(this);e("label[for="+a.attr("id")+"]");var b=a.next(".ranger");b.find(".ranger-handle");b.off(".ranger").remove();a.off(".ranger").removeClass("ranger-element")})}};e.fn.ranger=function(a){return n[a]?n[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:m.apply(this,arguments)}})(jQuery);